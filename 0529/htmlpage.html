<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>채팅</title>
<!--디바이스 너비에 맞게 현재 페이지를 출력 -->
<meta name="viewport" content="width=device-width, initial-scale=1" />
<!-- jquery mobile의 stylesheet -->
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.css" />
	<!--    -->
	<script src="http://code.jquery.com/jquery-1.8.2.min.js"></script>
	<!-- jquery mobile 링크  -->
	<script src="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.js"></script>
	<!-- node의 socketio 링크설정  -->
    <script src="/socket.io/socket.io.js"></script>

</head>
<body>
<!-- 하나의 페이지생성 -->
<div data-role='page'>
<div data-role='header'>
<h1>채팅</h1>
</div>
<div data-role="content">
<h3>대화명</h3>
<input id="name"/>
<a data-role='button' href='#chatPage'>채팅시작</a>
</div>
</div>

<!-- 채팅페이지  -->
<div data-role='page'  id='chatPage'>
<div data-role='header'>
<h1>채팅</h1>
</div>
<div data-role='content'>
<!--  메세지 입력창  -->
<input id='message'/>
<button>전송</button>
<!--메세지 출력창  -->
<ul id='content' data-role='Listview' data-inset='true'>
</ul>
</div>
</div>
<script >
//문서 구조를 파악한후 동작 여러번 작성하면 코드를 모두 합쳐서 동작수행  :여러번 사용해도 이전 내용이 삭제되지 않습니다 .
$(function(){
	//소켓생성
	var socket=io.connect('http://localhost:9003');
	//소켓 이벤트 등록
	//메세지 저ㅏㄴ송
	socket.on('message', function(data){
		var output='';
		output +='<li>';
		output +='<h3>'+data.name+'</h3>';
		output +='<p>'+data.message+'</p>';
		output +='<p>'+data.date+'</p>';
		output+='</li>';
		$(output).prependTo('#content');
		//다시출력
		$('#content').listview('refresh');
	});
	
	//버튼을 눌렀을때 이벤트 처리
	$('button').click(function(){
		//소켓에게 메세지 전송
		socket.emit('message',{
			name:$('#name').val(),
			message:$('#message').val(),
			date:new Date().toUTCString()
		});
		//alert("접속확인");
	});
});
</script>
</body>
</html>